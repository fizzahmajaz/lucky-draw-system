<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <title>User Login</title>

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="/assets/css/style.css">

    <style>
        body {
            background: linear-gradient(135deg, #dbeafe, #f1f5f9);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .login-card {
            width: 100%;
            max-width: 420px;
            background: white;
            padding: 35px;
            border-radius: 22px;
            box-shadow: 0 10px 35px rgba(0, 0, 0, 0.12);
        }

        .title {
            font-size: 28px;
            font-weight: 700;
            text-align: center;
            margin-bottom: 15px;
        }

        .subtitle {
            font-size: 14px;
            color: #64748b;
            text-align: center;
            margin-bottom: 25px;
        }

        .input-label {
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 6px;
        }

        .switch-link {
            text-align: center;
            margin-top: 15px;
        }

        .switch-link a {
            font-weight: 600;
            cursor: pointer;
        }
    </style>
</head>

<body>

    <div class="login-card">

        <div class="title">Welcome Back</div>
        <div class="subtitle">Login to continue to your dashboard</div>

        <div class="toast-box" id="toast-box"></div>

        <!-- Username or Email -->
        <div class="mb-3">
            <label class="input-label">Username or Email</label>
            <input type="text" id="username" class="form-control" placeholder="Enter username or email">
        </div>

        <!-- Password -->
        <div class="mb-3">
            <label class="input-label">Password</label>
            <input type="password" id="password" class="form-control" placeholder="Enter password">
        </div>

        <!-- Login Button -->
        <button class="btn btn-primary w-100" onclick="loginUser()">Login</button>

        <div class="switch-link">
            Donâ€™t have an account?
            <a onclick="redirectTo('/user/register.html')">Register</a><br>
            Or <a onclick="redirectTo('/user/guest.html')">Continue as Guest</a>
        </div>

    </div>

    <script src="/assets/js/common.js"></script>

    <script>
        function loginUser() {

            var username = document.getElementById("username").value.trim();
            var password = document.getElementById("password").value.trim();

            if (username === "" || password === "") {
                showToast("All fields are required", false);
                return;
            }

            var body = {
                usernameOrEmail: username,
                password: password
            };

            apiFetch("/users/login", "POST", body)
                .then(function (json) {

                    if (!json || !json.success) {
                        showToast("Invalid login details", false);
                        return;
                    }

                    var user = json.data;

                    localStorage.setItem("userId", user.id);

                    showToast("Login successful!", true);

                    setTimeout(function () {
                        redirectTo("/user/dashboard.html");
                    }, 800);
                });
        }

        function redirectTo(url) {
            window.location.href = url;
        }
    </script>

</body>

</html>
